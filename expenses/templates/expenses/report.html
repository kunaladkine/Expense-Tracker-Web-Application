{% extends "expenses/base.html" %}
{% block content %}
<h1>Reports</h1>

<div class="row mb-4">
  <div class="col-md-8">
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">Monthly totals (last 12 months)</h5>
        <canvas id="monthlyChart" width="600" height="300"></canvas>
        <p class="mt-2">Average per month: <strong>{{ avg_month }}</strong></p>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Top Expenses</h5>
        <table class="table table-sm">
          <thead><tr><th>Date</th><th>Title</th><th>Category</th><th class="text-end">Amount</th></tr></thead>
          <tbody>
            {% for e in top_expenses %}
              <tr>
                <td>{{ e.date }}</td>
                <td>{{ e.title }}</td>
                <td>{{ e.category }}</td>
                <td class="text-end">{{ e.amount }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="4">No expenses.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <div class="col-md-4">
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">Top Categories</h5>
        <canvas id="catChart" width="300" height="300"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
  const months = {{ months|safe }};
  const values = {{ values|safe }};
  const topCats = {{ top_cats|safe }};
  const catLabels = topCats.map(c => c.name);
  const catValues = topCats.map(c => c.total);

  new Chart(document.getElementById('monthlyChart').getContext('2d'), {
    type: 'line',
    data: { labels: months, datasets: [{ label: 'Monthly total', data: values, fill:false, tension:0.3 }] },
    options: { responsive:true }
  });

  new Chart(document.getElementById('catChart').getContext('2d'), {
    type: 'bar',
    data: { labels: catLabels, datasets: [{ label: 'Category total', data: catValues }] },
    options: { responsive:true }
  });
</script>
{% endblock %}
